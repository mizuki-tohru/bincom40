//#pragma once

#include "lua\lua.hpp"
#include "stdafx.h"

#define BUF_SIZE	2048*4
//#define MAX_CLIENTS	16

/*--------------------------------------------------------------------------*/
using namespace std;
/*--------------------------------------------------------------------------*/
int HDS2102S_getwaveform2(lua_State * );
int HDS2102S_getwavebmp2(lua_State * );
void HDS2102S_getwaveform3(char *);
int DispStrP(lua_State * );
int DispParamlP(lua_State * );
int DispParamfP(lua_State * );
int SerialInit(lua_State * );
int SerialSend(lua_State * );
int SerialWaitRecv(lua_State * );
int SerialRecv(lua_State * );
int SerialRecv2(lua_State * );
int Sleep(lua_State * );
int uSleep(lua_State * );
int mSleep(lua_State * );
int HIDSend(lua_State * );
int HIDSendS(lua_State * );
//int HIDSendS3(char *,unsigned char *);
int HIDSendS3(char *,char *);
int HIDRecv(lua_State * );
int HIDRecv2(lua_State * );
int HIDRecv3(char *,unsigned char *);
int NetInitCheck(lua_State * );
int NetConnect(lua_State * );
int NetDisConnect(lua_State * );
int NetSend(lua_State * );
int NetWaitRecv(lua_State *);
int NetRecv(lua_State * );
int NetRecv2(lua_State * );
int DeviceSeq(lua_State * );
int RegRead(lua_State * );
int RegWrite(lua_State * );
int CRC16(lua_State * );
int mkframe(lua_State * );
int KeyWait(lua_State * L);
int SetC(lua_State * L);
int GetC(lua_State * L);
int GetAddr(lua_State * );

const unsigned char MFont[][8] =  {
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x18,0x18,0x18,0x18,0x00,0x18,0x18,0x00,},
{0x6C,0x6C,0x48,0x00,0x00,0x00,0x00,0x00,},
{0x6C,0x6C,0xFE,0x6C,0xFE,0x6C,0x6C,0x00,},
{0x10,0x7C,0xD0,0x7C,0x16,0x7C,0x10,0x00,},
{0x62,0x66,0x0C,0x18,0x30,0x66,0x46,0x00,},
{0x38,0x6C,0x68,0x76,0xDC,0xCC,0x76,0x00,},
{0x18,0x18,0x30,0x00,0x00,0x00,0x00,0x00,},
{0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00,},
{0x30,0x18,0x0C,0x0C,0x0C,0x18,0x30,0x00,},
{0x00,0x6C,0x38,0xFE,0x38,0x6C,0x00,0x00,},
{0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x10,},
{0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,},
{0x02,0x06,0x0C,0x18,0x30,0x60,0x40,0x00,},
{0x3C,0x66,0x6E,0x76,0x66,0x66,0x3C,0x00,},
{0x18,0x18,0x38,0x18,0x18,0x18,0x3C,0x00,},
{0x7C,0x06,0x06,0x3C,0x60,0x60,0x7E,0x00,},
{0x7C,0x06,0x06,0x1C,0x06,0x06,0x7C,0x00,},
{0x66,0x66,0x66,0x7E,0x06,0x06,0x06,0x00,},
{0x7E,0x60,0x60,0x7C,0x06,0x06,0x7C,0x00,},
{0x3E,0x60,0x60,0x7C,0x66,0x66,0x3C,0x00,},
{0x7E,0x06,0x0C,0x18,0x18,0x18,0x18,0x00,},
{0x3C,0x66,0x66,0x3C,0x66,0x66,0x3C,0x00,},
{0x3C,0x66,0x66,0x3E,0x06,0x06,0x7C,0x00,},
{0x00,0x18,0x18,0x00,0x18,0x18,0x00,0x00,},
{0x00,0x00,0x18,0x18,0x00,0x18,0x18,0x10,},
{0x0C,0x18,0x30,0x60,0x30,0x18,0x0C,0x00,},
{0x00,0x00,0x7E,0x00,0x7E,0x00,0x00,0x00,},
{0x30,0x18,0x0C,0x06,0x0C,0x18,0x30,0x00,},
{0x3C,0x66,0x06,0x1C,0x18,0x00,0x18,0x00,},
{0x3C,0x66,0x6E,0x6E,0x6E,0x60,0x3E,0x00,},
{0x3C,0x66,0x66,0x7E,0x66,0x66,0x66,0x00,},
{0x7C,0x66,0x66,0x7C,0x66,0x66,0x7C,0x00,},
{0x3C,0x66,0x60,0x60,0x60,0x66,0x3C,0x00,},
{0x7C,0x66,0x66,0x66,0x66,0x66,0x7C,0x00,},
{0x7E,0x60,0x60,0x78,0x60,0x60,0x7E,0x00,},
{0x7E,0x60,0x60,0x78,0x60,0x60,0x60,0x00,},
{0x3C,0x66,0x60,0x6E,0x66,0x66,0x3C,0x00,},
{0x66,0x66,0x66,0x7E,0x66,0x66,0x66,0x00,},
{0x7E,0x18,0x18,0x18,0x18,0x18,0x7E,0x00,},
{0x0E,0x06,0x06,0x06,0x06,0x66,0x3C,0x00,},
{0x66,0x6C,0x78,0x70,0x78,0x6C,0x66,0x00,},
{0x60,0x60,0x60,0x60,0x60,0x60,0x7E,0x00,},
{0xC6,0xEE,0xFE,0xD6,0xC6,0xC6,0xC6,0x00,},
{0x66,0x76,0x7E,0x6E,0x66,0x66,0x66,0x00,},
{0x3C,0x66,0x66,0x66,0x66,0x66,0x3C,0x00,},
{0x7C,0x66,0x66,0x7C,0x60,0x60,0x60,0x00,},
{0x3C,0x66,0x66,0x66,0x6E,0x6E,0x3E,0x00,},
{0x7C,0x66,0x66,0x7C,0x66,0x66,0x66,0x00,},
{0x3E,0x60,0x60,0x3C,0x06,0x06,0x7C,0x00,},
{0x7E,0x18,0x18,0x18,0x18,0x18,0x18,0x00,},
{0x66,0x66,0x66,0x66,0x66,0x66,0x3C,0x00,},
{0x66,0x66,0x66,0x66,0x3C,0x3C,0x18,0x00,},
{0xC6,0xC6,0xC6,0xD6,0xFE,0xEE,0xC6,0x00,},
{0x66,0x66,0x3C,0x18,0x3C,0x66,0x66,0x00,},
{0x66,0x66,0x66,0x3C,0x18,0x18,0x18,0x00,},
{0x7E,0x06,0x0C,0x18,0x30,0x60,0x7E,0x00,},
{0x3C,0x30,0x30,0x30,0x30,0x30,0x3C,0x00,},
{0x40,0x60,0x30,0x18,0x0C,0x06,0x02,0x00,},
{0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x3C,0x00,},
{0x10,0x38,0x6C,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,},
{0x18,0x18,0x08,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x3C,0x06,0x3E,0x66,0x3E,0x00,},
{0x60,0x60,0x7C,0x66,0x66,0x66,0x7C,0x00,},
{0x00,0x00,0x3C,0x66,0x60,0x66,0x3C,0x00,},
{0x06,0x06,0x3E,0x66,0x66,0x66,0x3E,0x00,},
{0x00,0x00,0x3C,0x66,0x7C,0x60,0x3E,0x00,},
{0x0E,0x18,0x18,0x3C,0x18,0x18,0x3C,0x00,},
{0x00,0x00,0x3E,0x66,0x66,0x3E,0x06,0x7C,},
{0x60,0x60,0x7C,0x66,0x66,0x66,0x66,0x00,},
{0x18,0x00,0x18,0x18,0x18,0x18,0x18,0x00,},
{0x18,0x00,0x18,0x18,0x18,0x18,0x18,0x70,},
{0x60,0x60,0x66,0x6C,0x78,0x6C,0x66,0x00,},
{0x30,0x30,0x30,0x30,0x30,0x30,0x1C,0x00,},
{0x00,0x00,0xCC,0xFE,0xD6,0xC6,0xC6,0x00,},
{0x00,0x00,0x7C,0x66,0x66,0x66,0x66,0x00,},
{0x00,0x00,0x3C,0x66,0x66,0x66,0x3C,0x00,},
{0x00,0x00,0x7C,0x66,0x66,0x7C,0x60,0x60,},
{0x00,0x00,0x3E,0x66,0x66,0x3E,0x06,0x06,},
{0x00,0x00,0x36,0x38,0x30,0x30,0x30,0x00,},
{0x00,0x00,0x3E,0x60,0x3C,0x06,0x7C,0x00,},
{0x18,0x18,0x18,0x3C,0x18,0x18,0x0C,0x00,},
{0x00,0x00,0x66,0x66,0x66,0x66,0x3C,0x00,},
{0x00,0x00,0x66,0x66,0x3C,0x3C,0x18,0x00,},
{0x00,0x00,0xC6,0xC6,0xD6,0xFE,0xEC,0x00,},
{0x00,0x00,0x66,0x3C,0x18,0x3C,0x66,0x00,},
{0x00,0x00,0x66,0x66,0x66,0x3E,0x06,0x7C,},
{0x00,0x00,0x7E,0x0C,0x18,0x30,0x7E,0x00,},
{0x1C,0x30,0x30,0x60,0x30,0x30,0x1C,0x00,},
{0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x00,},
{0x38,0x0C,0x0C,0x06,0x0C,0x0C,0x38,0x00,},
{0x32,0x4C,0x00,0x00,0x00,0x00,0x00,0x00,},
{0xAA,0x55,0xAA,0x55,0xAA,0x55,0xAA,0x55,},
{0xC0,0xF0,0xFC,0xFF,0xFC,0xF0,0xC0,0x00,},
{0x03,0x0F,0x3F,0xFF,0x3F,0x0F,0x03,0x00,},
};

/*--------------------------------------------------------------------------*/
/* 拡張Bitmapヘッダ構造体													*/
/*--------------------------------------------------------------------------*/
struct EXBITMAPINFO{
//	BITMAPFILEHEADER    BmFileHed;
	BITMAPINFOHEADER	BmInfoHed;
	RGBQUAD				bmiColors[256];
};

/*シリアルポート設定構造体*/
struct comm_data2{
	char comm_string[16];
	long BaudRate_read;
	int modem_flg;
	int Init;
};

struct serial_param{
	int no;
	char comm_string[32] = {0};
	long BaudRate;
	int modem_flg;
	int Init;
	int delimiter = 0;
	unsigned char ByteSize;
	unsigned char Parity;
	unsigned char fParity;
	unsigned char StopBits;
	unsigned char newline = 0;
	int USB;
	int VID;
	int PID;
	TCHAR SERIAL[65];
};

/*---受信データバッファ構造体--*/
struct rcv_data2{
	unsigned char	buf[1024];
	DWORD len;
};
//struct ComReadBuf3{
//	unsigned char Buf[COMMBUFSIZE];
//	unsigned char Buf2[COMMBUFSIZE];
//	long len;
//	long len2;
//	int flg;
//	
//};
struct dispframe{
	char str_Name[36][32];
	char str_Val[36][32];
	int str_U[36];
};

struct ScaleS{
	char * name;
	double scale;
};


//extern unsigned char frm[31][66];		//画面表示キャラクタバッファ
//extern char frm[30][66];		//画面表示キャラクタバッファ
//extern unsigned long wtpoint;	//表示終端文字位置
extern int FIXParam_Cnt;

extern HWND   		hogeWnd;	/*メインウィンドウハンドラのコピー*/
extern HFONT		hNewFont;		//フォントハンドル
extern HFONT		hDispFont;		//フォントハンドル
extern HFONT		hUFont;		//フォントハンドル
extern DCB			dcb;		//シリアルポートのDCB構造体
extern CRITICAL_SECTION cscom;
extern std::map<int,char[32]> PortList;
extern struct dispframe CDSP;
extern struct serial_param COMMPARAM[5];
extern struct ComReadBuf COMBUF[6];

